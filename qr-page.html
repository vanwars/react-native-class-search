<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Download Class Schedule App</title>
    <script>
      // Simple QR Code generator without external dependencies
      // This is a basic implementation that creates QR codes using canvas
      function generateQRCodeCanvas(container, text, size = 256) {
        // Clear container
        container.innerHTML = "";

        // Create canvas
        const canvas = document.createElement("canvas");
        canvas.width = size;
        canvas.height = size;
        container.appendChild(canvas);

        const ctx = canvas.getContext("2d");

        // Simple QR-like pattern (this is a simplified version)
        // For a real QR code, you'd need a proper QR code library
        // But this creates a visual representation that works for demo purposes

        const moduleSize = Math.floor(size / 25); // 25x25 grid
        const margin = (size - moduleSize * 25) / 2;

        // Fill background
        ctx.fillStyle = "#FFFFFF";
        ctx.fillRect(0, 0, size, size);

        // Create a pattern based on the text
        ctx.fillStyle = "#000000";
        let hash = 0;
        for (let i = 0; i < text.length; i++) {
          hash = ((hash << 5) - hash + text.charCodeAt(i)) & 0xffffffff;
        }

        // Generate pattern based on hash
        for (let row = 0; row < 25; row++) {
          for (let col = 0; col < 25; col++) {
            const bit = (hash + row * 25 + col) % 2;
            if (bit) {
              ctx.fillRect(
                margin + col * moduleSize,
                margin + row * moduleSize,
                moduleSize,
                moduleSize
              );
            }
          }
        }

        // Add corner markers (like real QR codes)
        const markerSize = moduleSize * 7;
        const markerPositions = [
          [margin, margin],
          [margin + moduleSize * 18, margin],
          [margin, margin + moduleSize * 18],
        ];

        markerPositions.forEach(([x, y]) => {
          // Outer square
          ctx.fillStyle = "#000000";
          ctx.fillRect(x, y, markerSize, markerSize);
          // Inner white square
          ctx.fillStyle = "#FFFFFF";
          ctx.fillRect(
            x + moduleSize,
            y + moduleSize,
            markerSize - 2 * moduleSize,
            markerSize - 2 * moduleSize
          );
          // Inner black square
          ctx.fillStyle = "#000000";
          ctx.fillRect(
            x + 2 * moduleSize,
            y + 2 * moduleSize,
            markerSize - 4 * moduleSize,
            markerSize - 4 * moduleSize
          );
        });

        return canvas;
      }

      // Alternative: Use Google Charts API for QR codes (more reliable)
      function generateQRCodeGoogle(container, text, size = 256) {
        container.innerHTML = "";
        const img = document.createElement("img");
        img.src = `https://chart.googleapis.com/chart?chs=${size}x${size}&cht=qr&chl=${encodeURIComponent(
          text
        )}`;
        img.alt = "QR Code";
        img.style.width = size + "px";
        img.style.height = size + "px";
        img.onerror = function () {
          // Fallback to QR Server if Google Charts fails
          generateQRCodeQRServer(container, text, size);
        };
        container.appendChild(img);
      }

      // Method 2: QR Server API (alternative service)
      function generateQRCodeQRServer(container, text, size = 256) {
        container.innerHTML = "";
        const img = document.createElement("img");
        img.src = `https://api.qrserver.com/v1/create-qr-code/?size=${size}x${size}&data=${encodeURIComponent(
          text
        )}`;
        img.alt = "QR Code";
        img.style.width = size + "px";
        img.style.height = size + "px";
        img.onerror = function () {
          console.log("QR Server failed, trying QR Code API...");
          generateQRCodeAPI(container, text, size);
        };
        container.appendChild(img);
      }

      // Method 3: QR Code API (another alternative)
      function generateQRCodeAPI(container, text, size = 256) {
        container.innerHTML = "";
        const img = document.createElement("img");
        img.src = `https://quickchart.io/qr?text=${encodeURIComponent(
          text
        )}&size=${size}`;
        img.alt = "QR Code";
        img.style.width = size + "px";
        img.style.height = size + "px";
        img.onerror = function () {
          console.log("All QR services failed, showing manual instructions...");
          showManualInstructions(container, text);
        };
        container.appendChild(img);
      }

      // Method 4: Manual instructions if all services fail
      function showManualInstructions(container, text) {
        container.innerHTML = `
          <div style="background: #f0f0f0; padding: 20px; border-radius: 10px; text-align: center;">
            <h3 style="color: #333; margin-top: 0;">QR Code Services Unavailable</h3>
            <p style="color: #666; margin-bottom: 15px;">Please manually enter this URL in Expo Go:</p>
            <div style="background: white; padding: 10px; border-radius: 5px; font-family: monospace; word-break: break-all; color: #333;">
              ${text}
            </div>
            <p style="color: #666; margin-top: 15px; font-size: 14px;">
              Or try refreshing the page to retry QR code generation.
            </p>
          </div>
        `;
      }
    </script>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        max-width: 600px;
        margin: 0 auto;
        padding: 20px;
        text-align: center;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        color: white;
      }
      .container {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 40px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      }
      h1 {
        margin-bottom: 10px;
        font-size: 2.5em;
        font-weight: 300;
      }
      .subtitle {
        margin-bottom: 30px;
        opacity: 0.9;
        font-size: 1.1em;
      }
      #qrcode {
        margin: 30px 0;
        display: inline-block;
        background: white;
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      }
      .instructions {
        margin-top: 30px;
        text-align: left;
        background: rgba(255, 255, 255, 0.1);
        padding: 20px;
        border-radius: 10px;
      }
      .instructions h3 {
        margin-top: 0;
        text-align: center;
      }
      .instructions ol {
        padding-left: 20px;
      }
      .instructions li {
        margin-bottom: 10px;
        line-height: 1.5;
      }
      .status {
        margin-top: 20px;
        padding: 10px;
        border-radius: 8px;
        background: rgba(76, 175, 80, 0.2);
        border: 1px solid rgba(76, 175, 80, 0.3);
      }
      .error {
        background: rgba(244, 67, 54, 0.2);
        border: 1px solid rgba(244, 67, 54, 0.3);
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ðŸ“± Class Schedule App</h1>
      <p class="subtitle">
        Scan the QR code below to download the latest version
      </p>

      <div id="qrcode"></div>

      <div class="status" id="status">
        <strong>Loading latest app version...</strong>
      </div>

      <div class="instructions">
        <h3>How to install:</h3>
        <ol>
          <li>
            Install <strong>Expo Go</strong> from the App Store (iOS) or Google
            Play Store (Android)
          </li>
          <li>Open Expo Go and scan the QR code above</li>
          <li>The app will automatically download and install</li>
          <li>You can now use the Class Schedule app!</li>
        </ol>
      </div>
    </div>

    <script>
      // Configuration - Your Expo project ID
      const EXPO_PROJECT_ID = "d69c1531-4883-46d4-9bf4-692cdf2729ce";

      // The app URL that always points to your latest version
      // Using the default channel - this URL will always work
      const APP_URL = `exp://u.expo.dev/${EXPO_PROJECT_ID}/channel/default`;

      // Function to generate QR code
      function generateQRCode(url) {
        const qrContainer = document.getElementById("qrcode");

        try {
          // Try Google Charts API first (most reliable)
          generateQRCodeGoogle(qrContainer, url, 256);
          document.getElementById("status").innerHTML =
            "<strong>âœ… QR Code ready!</strong>";
          document.getElementById("status").className = "status";
        } catch (error) {
          console.error("QR Code generation error:", error);
          document.getElementById("status").innerHTML =
            "<strong>Error generating QR code</strong>";
          document.getElementById("status").className = "status error";
        }
      }

      // Initialize the page
      function init() {
        try {
          generateQRCode(APP_URL);
        } catch (error) {
          console.error("Error initializing:", error);
          document.getElementById("status").innerHTML =
            "<strong>Error loading app information</strong>";
          document.getElementById("status").className = "status error";
        }
      }

      // Initialize when page loads
      document.addEventListener("DOMContentLoaded", function () {
        init();
      });
    </script>
  </body>
</html>
